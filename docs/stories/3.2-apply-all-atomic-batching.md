# Story 3.2: Apply-All with Atomic Transaction Batching

## Status: Ready

## Story
**As a** UX Writer  
**I want to** apply multiple fixes in bulk with progress indication  
**So that** I can efficiently resolve many issues while maintaining system stability

## Epic
Epic 3: Fix Application & Undo (MVP)

## Acceptance Criteria
1. **AC2.1**: Apply-all functionality works by rule type or issue group
   - "Apply All" buttons for rule groups and severity levels
   - Option to apply all issues on current page
   - Confirmation dialog for bulk operations

2. **AC2.2**: Operations use atomic transaction batching for reliability
   - All fixes in a batch succeed or fail together
   - No partial application that leaves inconsistent state
   - Rollback capability if any fix fails

3. **AC2.3**: Progress UI shows completion status during bulk operations
   - Progress bar or counter showing completion status
   - Cancel button to abort long-running operations
   - Clear indication of which items are being processed

4. **AC2.4**: Entire batch can be undone as a single operation
   - Single undo entry in Figma's history for entire batch
   - Ctrl+Z/Cmd+Z undoes all fixes in the batch
   - Batch operations are atomic from undo perspective

5. **AC2.5**: System remains responsive during large bulk operations
   - UI doesn't freeze during bulk processing
   - Background processing with progress updates
   - User can interact with other parts of plugin

## Priority
High - Efficiency feature

## Effort Estimate
8 story points

## Dependencies
- Story 3.1: Single fix application (for base functionality)
- Story 2.2: Issues panel (for grouping and selection)

## Tasks / Subtasks
- [ ] **Task 1**: Design batch operation architecture
  - [ ] Plan atomic transaction system
  - [ ] Design batch processing pipeline
  - [ ] Define rollback and error handling

- [ ] **Task 2**: Implement batch selection logic
  - [ ] Rule-based batch selection
  - [ ] Page-based batch selection
  - [ ] Custom selection management

- [ ] **Task 3**: Build atomic transaction system
  - [ ] Transaction batching for Figma operations
  - [ ] All-or-nothing success/failure handling
  - [ ] Rollback mechanism for failed batches

- [ ] **Task 4**: Create progress indication UI
  - [ ] Progress bar component
  - [ ] Real-time status updates
  - [ ] Cancel operation functionality

- [ ] **Task 5**: Implement background processing
  - [ ] Asynchronous batch processing
  - [ ] Yield to main thread for UI responsiveness
  - [ ] Queue management for large batches

- [ ] **Task 6**: Integrate with undo system
  - [ ] Single undo entry for entire batch
  - [ ] Proper undo history integration
  - [ ] Batch operation naming in undo history

- [ ] **Task 7**: Add confirmation and safety features
  - [ ] Confirmation dialogs for large batches
  - [ ] Preview of changes before application
  - [ ] Safety limits for batch sizes

- [ ] **Task 8**: Testing and optimization
  - [ ] Performance testing with large batches
  - [ ] Atomic transaction testing
  - [ ] Error recovery testing

## Definition of Done
- [ ] Apply-all works for rule groups and pages
- [ ] Atomic transactions ensure consistency
- [ ] Progress indication works during operations
- [ ] Entire batch creates single undo entry
- [ ] UI remains responsive during processing
- [ ] Confirmation dialogs prevent accidents
- [ ] Error handling and rollback work correctly
- [ ] Performance acceptable for 100+ fixes

## Batch Operation Types
- All issues of specific rule type
- All issues on current page
- All issues of specific severity
- All selected issues (manual selection)

## Safety Features
- Confirmation for batches > 10 fixes
- Preview showing all changes
- Cancel operation at any time
- Automatic rollback on failure

## Performance Requirements
- Process 100 fixes in < 10 seconds
- UI remains responsive (< 100ms freeze)
- Progress updates every 500ms
- Memory usage scales linearly
