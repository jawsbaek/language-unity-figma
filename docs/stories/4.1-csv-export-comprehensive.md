# Story 4.1: CSV Export with Comprehensive Fields

## Status: Ready

## Story
**As a** Brand Manager or Team Lead  
**I want to** export issues to CSV format with detailed metadata  
**So that** I can analyze language consistency trends and create compliance reports

## Epic
Epic 4: Reporting (MVP)

## Acceptance Criteria
1. **AC1.1**: CSV export includes: page name, node ID, rule ID, severity, original text, suggested fix, status
   - All essential fields included in export
   - Headers clearly labeled and descriptive
   - Data properly formatted for spreadsheet applications

2. **AC1.2**: User can select which fields to include in the export
   - Checkbox interface for field selection
   - Preset field combinations (basic, detailed, audit)
   - Custom field selection with save preferences

3. **AC1.3**: Export handles special characters and text formatting correctly
   - Proper CSV escaping for commas, quotes, newlines
   - Unicode characters exported correctly
   - Text formatting preserved or stripped as appropriate

4. **AC1.4**: Large datasets are exported efficiently without UI blocking
   - Background processing for large exports
   - Progress indication during export generation
   - Streaming export for very large datasets

5. **AC1.5**: File naming includes timestamp and scope information
   - Automatic filename generation with timestamp
   - Scope information (page/file) in filename
   - User option to customize filename

## Priority
High - Essential for reporting

## Effort Estimate
6 story points

## Dependencies
- Story 2.2: Issues panel (for issue data)
- Story 4.3: Status lifecycle (for status information)

## Tasks / Subtasks
- [ ] **Task 1**: Design CSV export data structure
  - [ ] Define all available export fields
  - [ ] Plan field selection interface
  - [ ] Design CSV format and headers

- [ ] **Task 2**: Implement field selection UI
  - [ ] Create field selection checkboxes
  - [ ] Add preset field combinations
  - [ ] Save user preferences for field selection

- [ ] **Task 3**: Build CSV generation engine
  - [ ] CSV formatting with proper escaping
  - [ ] Unicode and special character handling
  - [ ] Efficient data serialization

- [ ] **Task 4**: Add export processing system
  - [ ] Background processing for large exports
  - [ ] Progress indication and cancellation
  - [ ] Memory-efficient streaming for large datasets

- [ ] **Task 5**: Implement file naming and download
  - [ ] Automatic filename generation with timestamps
  - [ ] Scope and filter information in filenames
  - [ ] File download trigger and handling

- [ ] **Task 6**: Create export UI controls
  - [ ] Export button with options
  - [ ] Export progress dialog
  - [ ] Export completion feedback

- [ ] **Task 7**: Add data validation and quality
  - [ ] Validate data completeness before export
  - [ ] Handle missing or null values
  - [ ] Data quality checks and warnings

- [ ] **Task 8**: Testing and optimization
  - [ ] Test with various dataset sizes
  - [ ] Validate CSV format with different applications
  - [ ] Performance optimization for large exports

## Definition of Done
- [ ] CSV export includes all required fields
- [ ] Field selection interface is functional
- [ ] Special characters and Unicode handled correctly
- [ ] Large datasets export without UI blocking
- [ ] Filenames include timestamp and scope info
- [ ] Export progress indication works
- [ ] CSV format is valid and opens in spreadsheet apps
- [ ] Performance acceptable for 10,000+ issues

## Available Export Fields
- Page Name
- Page ID  
- Node ID
- Node Name (if available)
- Rule ID
- Rule Name
- Rule Description
- Severity Level
- Original Text
- Suggested Fix
- Issue Status
- Created Timestamp
- Fixed Timestamp (if applicable)
- Character Position
- Issue Context

## File Naming Convention
```
figma-language-issues-{scope}-{timestamp}.csv
Examples:
- figma-language-issues-page-2024-01-15-14-30-00.csv
- figma-language-issues-file-2024-01-15-14-30-00.csv
```

## CSV Format Example
```csv
Page Name,Node ID,Rule ID,Severity,Original Text,Suggested Fix,Status,Created
Homepage,123:456,ko-spacing-001,warning,"됬다","됐다",Open,2024-01-15T14:30:00Z
Login Page,789:012,terminology-001,error,"로긴","로그인",Fixed,2024-01-15T14:31:00Z
```
