# Story 2.3: Inline Canvas Highlights

## Status: Ready

## Story
**As a** User  
**I want to** see visual highlights on flagged text spans in the canvas  
**So that** I can quickly locate and understand issues in context

## Epic
Epic 2: Scan & Issue Surfacing (MVP)

## Acceptance Criteria
1. **AC3.1**: Lightweight overlays appear on flagged text spans
   - Visual highlights appear directly over problematic text
   - Highlights are positioned accurately on text ranges
   - Multiple highlights can appear on the same text node

2. **AC3.2**: Highlights are visually distinct but not obtrusive
   - Subtle colored underlines or borders for different severities
   - Semi-transparent overlays that don't obscure text
   - Consistent visual language with severity levels

3. **AC3.3**: Toggle functionality to show/hide highlights
   - Toggle button in plugin panel to control visibility
   - Highlights state persists during plugin session
   - Quick keyboard shortcut for toggle (optional)

4. **AC3.4**: Highlights update when issues are resolved or ignored
   - Highlights disappear when fixes are applied
   - Ignored issues show different visual treatment
   - Real-time updates as user interacts with issues

5. **AC3.5**: Performance impact is minimal on canvas rendering
   - Highlights don't slow down canvas interactions
   - Efficient rendering for many simultaneous highlights
   - Smooth appearance/disappearance animations

## Priority
Medium - Enhances user experience

## Effort Estimate
6 story points

## Dependencies
- Story 2.1: Text traversal (for text positioning)
- Story 2.2: Issues panel (for issue data)
- Figma Plugin API overlay capabilities

## Tasks / Subtasks
- [ ] **Task 1**: Research Figma overlay capabilities
  - [ ] Investigate available overlay APIs
  - [ ] Test positioning accuracy and limitations
  - [ ] Understand performance characteristics

- [ ] **Task 2**: Design highlight visual system
  - [ ] Create visual designs for different severities
  - [ ] Define color palette and styling
  - [ ] Plan animation and transition effects

- [ ] **Task 3**: Implement highlight positioning
  - [ ] Calculate precise text span positions
  - [ ] Handle text wrapping and multi-line spans
  - [ ] Account for zoom levels and viewport changes

- [ ] **Task 4**: Build highlight rendering system
  - [ ] Create overlay components for different highlight types
  - [ ] Implement efficient rendering for multiple highlights
  - [ ] Add smooth show/hide animations

- [ ] **Task 5**: Create toggle controls
  - [ ] Add toggle button to plugin UI
  - [ ] Implement show/hide functionality
  - [ ] Add state persistence for toggle preference

- [ ] **Task 6**: Implement dynamic updates
  - [ ] Update highlights when issues are fixed
  - [ ] Handle ignored issues with different styling
  - [ ] Sync highlight state with issues panel

- [ ] **Task 7**: Optimize performance
  - [ ] Minimize rendering overhead
  - [ ] Implement highlight culling for off-screen content
  - [ ] Test performance with many highlights

- [ ] **Task 8**: Testing and refinement
  - [ ] Test positioning accuracy across different scenarios
  - [ ] Validate visual design and usability
  - [ ] Performance testing with large highlight sets

## Definition of Done
- [ ] Highlights appear accurately on flagged text spans
- [ ] Visual design is clear but not obtrusive
- [ ] Toggle functionality works reliably
- [ ] Highlights update dynamically with issue changes
- [ ] Performance impact is minimal and acceptable
- [ ] Works correctly with zoom and viewport changes
- [ ] Animations are smooth and polished

## Visual Design Requirements
- Error highlights: Red underline or border
- Warning highlights: Orange/yellow underline
- Info highlights: Blue or neutral underline
- Ignored issues: Grayed out or dotted styling
- Semi-transparent backgrounds where appropriate

## Technical Considerations
- Use Figma's overlay API efficiently
- Handle coordinate transformations for zoom/pan
- Manage highlight lifecycle with issue updates
- Consider memory usage with many highlights
- Ensure highlights don't interfere with text selection

## Edge Cases to Handle
- Very long text spans across multiple lines
- Overlapping highlights from different rules
- Text nodes that change size or position
- Highlights on very small text sizes
- High zoom levels affecting highlight visibility
